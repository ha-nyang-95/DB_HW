# PyFlink á„‰á…¥á†¯á„á…µ á„€á…¡á„‹á…µá„ƒá…³

ğŸ§  PyFlink ê³¼ì œ ì •ë¦¬ë³¸ (ë¹„ì „ê³µììš©)
=========================

* * *

1\. ğŸ“Œ ê³¼ì œ ê°œìš”
------------

**ëª©í‘œ**:  
CSVë¡œ ì£¼ì–´ì§„ ê¸ˆìœµ ê±°ë˜ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬, ê° ê±°ë˜ ìœ í˜•(`ì…ê¸ˆ`, `ì¶œê¸ˆ`, `êµ¬ë§¤` ë“±)ë³„ë¡œ **ì´ ê±°ë˜ ê¸ˆì•¡ì„ ì§‘ê³„**í•˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.

ì´ ë°ì´í„°ë¥¼ ìŠ¤íŠ¸ë¦¼ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ **Apache Flink**ì™€ \*\*PyFlink(Pythonìš© Flink API)\*\*ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

* * *

2\. ğŸ§° ì‚¬ì „ ì¤€ë¹„ ë‹¨ê³„ (ì²˜ìŒ í™˜ê²½ ì„¤ì •)
--------------------------

### âœ… 1) ê°€ìƒí™˜ê²½ ë§Œë“¤ê¸° (Python ì „ìš© ì‘ì—… ê³µê°„)

```bash
sudo apt update
sudo apt install python3-venv  # ê°€ìƒí™˜ê²½ ì„¤ì¹˜
mkdir ~/flink_project && cd ~/flink_project  # ì‘ì—… í´ë” ìƒì„±
python3 -m venv venv          # ê°€ìƒí™˜ê²½ ë§Œë“¤ê¸°
source venv/bin/activate      # ê°€ìƒí™˜ê²½ ì‹¤í–‰
```

### âœ… 2) í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
pip install apache-flink pandas
```

> âœ… ì„¤ì¹˜ í™•ì¸

```bash
python
>>> import pandas
>>> from pyflink.datastream import StreamExecutionEnvironment
>>> exit()
```

* * *

3\. âš™ï¸ Flink ì„¤ì¹˜ ë° ì‹¤í–‰ ì„¤ì •
-----------------------

### âœ… 1) Flink ì„¤ì¹˜

```bash
cd ~
wget https://downloads.apache.org/flink/flink-1.20.0/flink-1.20.0-bin-scala_2.12.tgz
tar -xvzf flink-1.20.0-bin-scala_2.12.tgz
sudo mv flink-1.20.0 /usr/local/flink-1.20.0
```

### âœ… 2) í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
export FLINK_HOME=/usr/local/flink-1.20.0
export PATH=$FLINK_HOME/bin:$PATH
source ~/.bashrc
```

* * *

4\. ğŸ“‚ CSV íŒŒì¼ ì˜ˆì‹œ
----------------

`data.csv` íŒŒì¼ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```csv
transaction_type,amount
ì…ê¸ˆ,10000
ì¶œê¸ˆ,5000
ì…ê¸ˆ,3000
êµ¬ë§¤,7000
ì…ê¸ˆ,9000
```

* * *

5\. ğŸ’» ì½”ë“œ ì„¤ëª… (`skeleton.py`)
----------------------------

ì•„ë˜ ì½”ë“œëŠ” PyFlinkë¥¼ ì´ìš©í•´ CSV ë°ì´í„°ë¥¼ ì½ê³ , ê° ê±°ë˜ ìœ í˜•ë³„ ì´ ê¸ˆì•¡ì„ ê³„ì‚°í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.

```python
import pandas as pd
from pyflink.datastream import StreamExecutionEnvironment
from pyflink.common.typeinfo import Types

def main():
    # 1. Flink ì‹¤í–‰ í™˜ê²½ ì„¤ì •
    env = StreamExecutionEnvironment.get_execution_environment()
    env.set_parallelism(2)  # ë³‘ë ¬ ì²˜ë¦¬ ìˆ˜ì¤€ (2ê°œì˜ ìŠ¤ë ˆë“œ ì‚¬ìš©)

    # 2. CSV ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° + ì „ì²˜ë¦¬
    df = pd.read_csv("./data/data.csv")  # CSV ë¶ˆëŸ¬ì˜¤ê¸°
    df = df[['transaction_type', 'amount']].dropna()  # ê²°ì¸¡ì¹˜ ì œê±°
    df['amount'] = df['amount'].astype(int)           # ê¸ˆì•¡ì„ intë¡œ ë³€í™˜
    transactions = df.values.tolist()                 # 2ì°¨ì› ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜

    # 3. ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ Flink ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë³€í™˜
    transaction_stream = env.from_collection(
        transactions,
        type_info=Types.TUPLE([Types.STRING(), Types.INT()])
    )

    # 4. ê±°ë˜ ìœ í˜•ë³„ë¡œ ê·¸ë£¹í•‘ í›„ ê¸ˆì•¡ í•©ì‚°
    transaction_total = (
        transaction_stream
        .key_by(lambda x: x[0])  # ê±°ë˜ ìœ í˜• ê¸°ì¤€ ê·¸ë£¹í•‘
        .reduce(lambda a, b: (a[0], a[1] + b[1]))  # ê¸ˆì•¡ í•©ì‚°
    )

    # 5. ê²°ê³¼ ì¶œë ¥
    transaction_total.print()

    # 6. Flink ì‹¤í–‰ ëª…ë ¹ì–´
    env.execute("Transaction Type Aggregation")

if __name__ == "__main__":
    main()
```

* * *

6\. â–¶ï¸ ì‹¤í–‰ ë°©ë²•
------------

### âœ… í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰

```bash
export FLINK_HOME=/usr/local/flink-1.20.0
$FLINK_HOME/bin/flink run -py skeleton.py
```

### âœ… ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ

(ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©´ ì•„ë˜ì™€ ê°™ì´ ê²°ê³¼ê°€ í„°ë¯¸ë„ì— ë‚˜ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤)

```
(banks, 40000)
(cash, 12000)
(deposit, 19000)
...
```

* * *

7\. ğŸ§© ìì£¼ ë‚˜ì˜¤ëŠ” ì—ëŸ¬ì™€ í•´ê²°ë²•
---------------------

| ì—ëŸ¬ ë©”ì‹œì§€ | ì›ì¸ ë° í•´ê²° ë°©ë²• |
| --- | --- |
| `Field 1 is null` | CSVì— ê²°ì¸¡ì¹˜ê°€ ìˆì–´ì„œ â†’ `dropna()`ì™€ `astype(int)`ë¡œ ì²˜ë¦¬ |
| `cannot serialize` | ë¦¬ìŠ¤íŠ¸ì— `None` í¬í•¨ ì‹œ ë°œìƒ â†’ ìœ„ì™€ ë™ì¼ |
| `ModuleNotFoundError` | `pandas` í˜¹ì€ `pyflink` ì„¤ì¹˜ ì•ˆ ë¨ â†’ `pip install`ë¡œ ì„¤ì¹˜ |
| ê²°ê³¼ê°€ ì•ˆ ë³´ì„ | `print()` ê²°ê³¼ê°€ ì•ˆ ë‚˜ì˜¤ëŠ” ê²½ìš° ìˆìŒ â†’ FileSinkë¡œ íŒŒì¼ ì €ì¥ ê¶Œì¥ |

* * *

8\. ğŸ“ ê²°ê³¼ íŒŒì¼ë¡œ ì €ì¥í•˜ê¸° (ì„ íƒ ì‚¬í•­)
--------------------------

í„°ë¯¸ë„ì— ê²°ê³¼ê°€ ì•ˆ ë³´ì´ë©´, ì•„ë˜ì²˜ëŸ¼ íŒŒì¼ë¡œ ì €ì¥í•´ë„ ë©ë‹ˆë‹¤:

```python
from pyflink.datastream.connectors import StreamingFileSink
from pyflink.common.serialization import SimpleStringEncoder
from pyflink.datastream import FileSink, OutputFileConfig

# ë¬¸ìì—´ë¡œ ë³€í™˜ í›„ ì¶œë ¥ ì €ì¥
sink = FileSink \
    .for_row_format("./output", SimpleStringEncoder()) \
    .with_output_file_config(OutputFileConfig.builder().with_part_prefix("result").build()) \
    .build()

transaction_total.map(lambda x: str(x), output_type=Types.STRING()).sink_to(sink)
```

â†’ ì‹¤í–‰ í›„ `output/` í´ë”ì— ê²°ê³¼ê°€ ì €ì¥ë©ë‹ˆë‹¤.

* * *

9\. ğŸ”‘ í•µì‹¬ ê°œë… ì •ë¦¬
---------------

| ìš©ì–´ | ì˜ë¯¸ |
| --- | --- |
| `StreamExecutionEnvironment` | Flinkì—ì„œ ìŠ¤íŠ¸ë¦¼ ì‘ì—…ì„ ìœ„í•œ í™˜ê²½ ì„¤ì • ê°ì²´ |
| `from_collection()` | ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ Flink ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë³€í™˜ |
| `key_by()` | íŠ¹ì • ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹í•‘ (ì—¬ê¸°ì„  ê±°ë˜ ìœ í˜•) |
| `reduce()` | ê·¸ë£¹ ë‚´ ê°’ë“¤ì„ ëˆ„ì  (ì—¬ê¸°ì„  ê¸ˆì•¡ í•©ì‚°) |
| `print()` | ì‹¤í–‰ ê²°ê³¼ë¥¼ ì½˜ì†”ì— ì¶œë ¥ |
| `env.execute()` | Flink í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì‹œì‘ |

* * *

âœ… ë§ˆë¬´ë¦¬ ìš”ì•½
--------

*   CSV â†’ pandasë¡œ ë¶ˆëŸ¬ì˜¤ê¸°
    
*   NaN ì œê±°, intë¡œ ë³€í™˜
    
*   ë¦¬ìŠ¤íŠ¸ â†’ Flink ìŠ¤íŠ¸ë¦¼ ë³€í™˜
    
*   key\_byë¡œ ê·¸ë£¹í•‘, reduceë¡œ ëˆ„ì í•©
    
*   ê²°ê³¼ ì¶œë ¥ or íŒŒì¼ ì €ì¥
    
*   Flink ì‹¤í–‰ (`flink run -py íŒŒì¼ëª….py`)
    

* * *

í•„ìš”í•˜ì‹œë©´ ì´ ë‚´ìš©ì„ PDFë‚˜ Markdownìœ¼ë¡œ ì •ë¦¬í•´ë“œë¦´ ìˆ˜ë„ ìˆì–´ìš”!  
ì¶”ê°€ì ìœ¼ë¡œ ê¶ê¸ˆí•œ ë‚´ìš©ì´ë‚˜ ëª¨í˜¸í•œ ë¶€ë¶„ ìˆìœ¼ë©´ ì–¼ë§ˆë“ ì§€ ë¬¼ì–´ë³´ì„¸ìš” :)



---
Powered by [ChatGPT Exporter](https://www.chatgptexporter.com)