# Elasticsearch 아키텍쳐와 데이터 처리
## Elasticsearch의 아케텍쳐와 분산 처리
### Elasticsearch의 클러스터 및 노드 개념
- 클러스터
  - Elasticsearch 클러스터는 하나 이상의 노드로 구성된 그룹
- 노드
  - Elasticsearch 개별 실행 인스턴스를 노드라고 함
### 클러스터
- 분산된 데이터 처리
- 노드의 역할과 관리
- 안정성과 가용성 확보
- 유연한 확장성과 성능 최적화
### 노드 유형
- 마스터 노드
  - 클러스터 전체의 작업을 관리
- 데이터 노드
- 인제스트 노드
- 코디네이팅 노드
### 마스터 노드
- 클러스터 관리 역할
  - Elasticsearch 클러스터의 핵심 관리자
- 중요한 결정 수행
- 연속적인 서비스 제공
  - 최소한 하나 이상의 마스터 노드 필요
- 고가용성을 위한 다중 마스터 노드 구성
- 클러스터 상태 모니터링 및 전환 관리
### 데이터 노드
- 데이터 저장 및 관리
- 색인 및 검색 처리
  - 하드웨어 리소스 많이 소모
- 안정적인 클러스터 운영
- 유연한 구성 가능
- 성능 및 비용 고려
### 인제스트 노드
- 데이터 수집 및 사전 처리
- 다양한 데이터 변환 지원
- 데이터 노드로 색인 최적화
- 리소스 분리 운영
- 자동화 및 색인 지원
### 코디네이팅 노드
- 클러스터의 요청을 라우팅하고 상태를 관리하는 역할
- 검색 및 색인 요청을 적절한 데이터 노드로 분산하여 처리
- 대규모 클러스터에서는 별도로 분리 운영하여 부하를 줄이는 것이 효과적
### 노드 역할 흐름
### 샤드
- Shard
  - 데이터를 나누어 저장하는 작은 단위
- Primary Shard
- Replica Shard
- primary shard는 기본적으로 '처음 인덱스 생성 시점'에서 설정한 이후에는 변경이 불가능
### Replication
- Replication
- Replication 동작 방식
- Replication의 장점
  - 고가용성
  - 부하 분산
  - 데이터 중복 저장
- Replication 고려사항
  - 노드 개수
  - 네트워크 및 저장소 부담
  - 트레이드오프
### 클러스터 내 기타 주요 요소
- Routing Table
- Gateway
- Discovery Module

## 클러스터 운영
### 정적 제어 vs 동적 제어
- 정적 제어
  - Docker Compose나 elasticsearch.yml에서 설정하는 항목들
  - 노드 단위로 초기에 구성하는 것들
- 동적 제어
  - Elasticsearch 실행 중 REST API로 변경하는 설정
### Elasticsearch 경로 설정(정적 제어)
- 데이터 경로 설정
### Elasticsearch network 설정
- 네트워크 호스트 설정
  - Elasticsearch의 네트워크 설정을 통해 개발 및 운영 환경을 구성
### Elasticsearch Discovery 설정
- 초기 마스터 노드 지정
### Elasticsearch Heap Size 설정
- Heap Size
- Xms와 Xmx 값은 동일하게 설정
  - 힙 크기는 최대 32GM를 넘지 않도록 설정
### Cluster 샤드 할당 설정
- 클러스터 내 노드에 샤드를 배분하는 과정
- 마스터 노드는 각 샤드를 어떤 노드에 할당할지 결정
### 마스터 후보 노드
- 마스터 후보 노드는 마스터 노드를 선출하는 역할
- 자기 자신도 마스터 노드로 선출될 수 있음
- Quorum-based decision making(중요 x)
- 구성 시 주의 사항
- 한 번에 절반 이상의 노드 제거 금지
- initial_master_nodes와의 관계
### 마스터 노드 선출
- 마스터 노드 역할
- 장애 발생 시 자동 선출
- 최소 3개 이상의 마스터 후보 노드 유지
- Voting-only 마스터 노드
- 설정 파일을 통한 구성
### Cluster 레벨 샤드 리밸런싱 설정
- 클러스터 내 데이터 균형을 맞추기 위해 샤드를 재배치
### 데이터 티어링
- 데이터를 Hot, Warm, Cold, Frozen 등의 계층(Tier)으로 나누어 저장하고 관리
- 클러스터 내 데이터 배포 전략
- 데이터 티어링을 활용하는 이유
  - 비용 절감
  - 성능 최적화
  - 데이터 수명주기 관리
  - 자동화 기능
- 노드 역할 설정
- 데이터 할당 규칙 설정
- 인덱스 레벨 티어링 설정
### 계층 간 데이터 이동
### ILM(인덱스 생명주기 관리)
- 인덱스 생명주기 관리
- ILM이 필요한 이유
- Alias
  - 다수의 인덱스를 논리적으로 하나로 묶어서 사용하기 위한 논리적 이름
- Rollover
  - 문서 수가 너무 많아지거나, 인덱스가 너무 오래되면 
  -> 새로운 인덱스를 자동 생성하고, alias를 새 인덱스로 옮김
### ILM 단계
- 단계별 티어 맞게 정책에 따라 이동할 수 있게 함
- Index Template 생성